{
    "typeName": "AWS::RedshiftServerless::EndpointAccess",
    "description": "Resource schema for a Redshift Serverless managed VPC endpoint.",
    "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-resource-providers-redshift-serverless",
    "definitions": {
        "VpcSecurityGroupMembership": {
            "description": "Describes the members of a VPC security group associated with the workgroup.",
            "type": "object",
            "properties": {
                "VpcSecurityGroupId": {
                    "type": "string",
                    "description": "The identifier of the VPC security group."
                },
                "Status": {
                    "type": "string",
                    "description": "The status of the VPC security group."
                }
            },
            "additionalProperties": false
        },
        "NetworkInterface": {
            "description": "Describes a network interface.",
            "type": "object",
            "properties": {
                "NetworkInterfaceId": {
                    "type": "string",
                    "description": "The network interface identifier."
                },
                "SubnetId": {
                    "type": "string",
                    "description": "The subnet identifier."
                },
                "PrivateIpAddress": {
                    "type": "string",
                    "description": "The IPv4 address of the network interface within the subnet."
                },
                "AvailabilityZone": {
                    "type": "string",
                    "description": "The Availability Zone."
                }
            },
            "additionalProperties": false
        }
    },
    "properties": {
        "EndpointName": {
            "description": "The name of the endpoint.",
            "type": "string",
            "pattern": "^(?=^[a-z][a-z0-9]*(-[a-z0-9]+)*$).{1,30}$"
        },
        "EndpointStatus": {
            "description": "The status of the VPC endpoint.",
            "type": "string"
        },
        "WorkgroupName": {
            "description": "The name of the workgroup.",
            "type": "string",
            "pattern": "^(?=^[a-z0-9-]+$).{3,64}$",
            "maxLength": 64,
            "minLength": 3
        },
        "EndpointCreateTime": {
            "description": "The time (UTC) that the endpoint was created.",
            "type": "string"
        },
        "Port": {
            "description": "The port number on which Amazon Redshift Serverless accepts incoming connections.",
            "type": "integer"
        },
        "Address": {
            "description": "The DNS address of the endpoint.",
            "type": "string"
        },
        "SubnetIds": {
            "description": "The unique identifier of subnets where Amazon Redshift Serverless choose to deploy the VPC endpoint.",
            "type": "array",
            "items": {
                "type": "string",
                "pattern": "^sg-[0-9a-fA-F]{8,}$",
                "maxLength": 255,
                "minLength": 0
            },
            "insertionOrder": false
        },
        "VpcSecurityGroups": {
            "description": "A list of Virtual Private Cloud (VPC) security groups to be associated with the endpoint.",
            "type": "array",
            "items": {
                "$ref": "#/definitions/VpcSecurityGroupMembership"
            },
            "insertionOrder": false
        },
        "VpcEndpoint": {
            "description": "The connection endpoint for connecting to Amazon Redshift Serverless.",
            "type": "object",
            "properties": {
                "VpcEndpointId": {
                    "type": "string",
                    "description": "The connection endpoint ID for connecting to Amazon Redshift Serverless."
                },
                "VpcId": {
                    "type": "string",
                    "description": "The VPC identifier that the endpoint is associated with."
                },
                "NetworkInterfaces": {
                    "type": "array",
                    "description": "One or more network interfaces of the endpoint. Also known as an interface endpoint.",
                    "items": {
                        "$ref": "#/definitions/NetworkInterface"
                    },
                    "insertionOrder": false
                }
            },
            "additionalProperties": false
        },
        "EndpointArn": {
            "description": "The Amazon Resource Name (ARN) of the VPC endpoint.",
            "type": "string"
        },
        "OwnerAccount": {
            "description": "Account Id of the resource owner",
            "type": "string"
        },
        "VpcSecurityGroupIds": {
            "description": "A list of VPC security group IDs to associate with the workgroup.",
            "type": "array",
            "insertionOrder": false,
            "items": {
                "type": "string",
                "pattern": "^sg-[0-9a-fA-F]{8,}$",
                "maxLength": 255,
                "minLength": 0
            }
        },
        "VpcId": {
            "type": "string"
        }
    },
    "tagging": {
        "taggable": false
    },
    "additionalProperties": false,
    "required": [
        "EndpointName"
    ],
    "primaryIdentifier": [
        "/properties/EndpointName"
    ],
    "createOnlyProperties": [
        "/properties/EndpointName"
    ],
    "readOnlyProperties": [
        "/properties/Address",
        "/properties/EndpointStatus",
        "/properties/EndpointCreateTime",
        "/properties/Port",
        "/properties/VpcSecurityGroups",
        "/properties/VpcEndpoint",
        "/properties/EndpointArn"
    ],
    "handlers": {
        "create": {
            "permissions": [
                "redshift-serverless:CreateEndpointAccess",
                "ec2:CreateClientVpnEndpoint",
                "ec2:DescribeVpcAttribute",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeAddresses",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeSubnets"
            ],
            "timeoutInMinutes": 60
        },
        "read": {
            "permissions": [
                "redshift-serverless:GetEndpointAccess",
                "ec2:DescribeClientVpnEndpoints",
                "ec2:DescribeVpcAttribute",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeAddresses",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeSubnets"
            ]
        },
        "update": {
            "permissions": [
                "redshift-serverless:UpdateEndpointAccess",
                "ec2:ModifyClientVpnEndpoint",
                "ec2:DescribeVpcAttribute",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeAddresses",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeSubnets"
            ],
            "timeoutInMinutes": 60
        },
        "delete": {
            "permissions": [
                "redshift-serverless:DeleteEndpointAccess",
                "ec2:DeleteClientVpnEndpoint",
                "ec2:DescribeVpcAttribute",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeAddresses",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeSubnets"
            ],
            "timeoutInMinutes": 60
        },
        "list": {
            "permissions": [
                "redshift-serverless:ListEndpointAccess",
                "ec2:DescribeClientVpnEndpoints",
                "ec2:DescribeVpcAttribute",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeAddresses",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeSubnets"
            ]
        }
    }
}